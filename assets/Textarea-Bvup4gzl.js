import{r as d,R as o}from"./index-uCp2LrAq.js";import{F as b}from"./FormGroup-BvpLCAgb.js";import{f as x}from"./factory-Dl037jXY.js";import{c as C}from"./clsx-B-dksMZM.js";import{B as $}from"./Base-CQ_ipzy_.js";import{H as k}from"./Hint-Cy41Y5xV.js";class l{constructor(e){this.$module=e,this.$textarea=e.querySelector(".nhsuk-js-character-count"),this.$visibleCountMessage=null,this.$screenReaderCountMessage=null,this.lastInputTimestamp=null}init(){if(!this.$textarea)return;const{$module:e}=this,{$textarea:t}=this,s=document.getElementById(`${t.id}-info`);t.insertAdjacentElement("afterend",s);const r=document.createElement("div");r.className="nhsuk-character-count__sr-status nhsuk-u-visually-hidden",r.setAttribute("aria-live","polite"),this.$screenReaderCountMessage=r,s.insertAdjacentElement("afterend",r);const a=document.createElement("div");a.className=s.className,a.classList.add("nhsuk-character-count__status"),a.setAttribute("aria-hidden","true"),this.$visibleCountMessage=a,s.insertAdjacentElement("afterend",a),s.classList.add("nhsuk-u-visually-hidden"),this.options=l.getDataset(e);let n=this.defaults.characterCountAttribute;this.options.maxwords&&(n=this.defaults.wordCountAttribute),this.maxLength=e.getAttribute(n),this.maxLength&&(t.removeAttribute("maxlength"),this.bindChangeEvents(),"onpageshow"in window?window.addEventListener("pageshow",this.updateCountMessage.bind(this)):window.addEventListener("DOMContentLoaded",this.updateCountMessage.bind(this)),this.updateCountMessage())}static getDataset(e){const t={},{attributes:s}=e;if(s)for(let r=0;r<s.length;r++){const a=s[r],n=a.name.match(/^data-(.+)/);n&&(t[n[1]]=a.value)}return t}count(e){let t;return this.options.maxwords?t=(e.match(/\S+/g)||[]).length:t=e.length,t}bindChangeEvents(){const{$textarea:e}=this;e.addEventListener("keyup",this.handleKeyUp.bind(this)),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this))}checkIfValueChanged(){this.$textarea.oldValue||(this.$textarea.oldValue=""),this.$textarea.value!==this.$textarea.oldValue&&(this.$textarea.oldValue=this.$textarea.value,this.updateCountMessage())}updateCountMessage(){this.updateVisibleCountMessage(),this.updateScreenReaderCountMessage()}updateVisibleCountMessage(){const{$textarea:e}=this,{$visibleCountMessage:t}=this,s=this.maxLength-this.count(e.value);this.isOverThreshold()?t.classList.remove("nhsuk-character-count__message--disabled"):t.classList.add("nhsuk-character-count__message--disabled"),s<0?(e.classList.add("nhsuk-textarea--error"),t.classList.remove("nhsuk-hint"),t.classList.add("nhsuk-error-message")):(e.classList.remove("nhsuk-textarea--error"),t.classList.remove("nhsuk-error-message"),t.classList.add("nhsuk-hint")),t.innerHTML=this.formattedUpdateMessage()}updateScreenReaderCountMessage(){const{$screenReaderCountMessage:e}=this;this.isOverThreshold()?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",!0),e.innerHTML=this.formattedUpdateMessage()}formattedUpdateMessage(){const{$textarea:e}=this,{options:t}=this,s=this.maxLength-this.count(e.value);let r="remaining",a="character",n=s;return t.maxwords&&(a="word"),a+=s===-1||s===1?"":"s",r=s<0?"too many":"remaining",n=Math.abs(s),`You have ${n} ${a} ${r}`}isOverThreshold(){const{$textarea:e}=this,{options:t}=this,s=this.count(e.value),{maxLength:r}=this,a=t.threshold?t.threshold:0;return r*a/100<=s}handleKeyUp(){this.updateVisibleCountMessage(),this.lastInputTimestamp=Date.now()}handleFocus(){this.valueChecker=setInterval(()=>{(!this.lastInputTimestamp||Date.now()-500>=this.lastInputTimestamp)&&this.checkIfValueChanged()},1e3)}handleBlur(){clearInterval(this.valueChecker)}}l.prototype.defaults={characterCountAttribute:"data-maxlength",wordCountAttribute:"data-maxwords"};const M=({scope:i=document}={})=>{i.querySelectorAll('[data-module="nhsuk-character-count"]').forEach(t=>{new l(t).init()})},m=x(({variant:i,maxLength:e,maxWords:t,...s},r)=>{d.useImperativeHandle(r,()=>a.current);const a=d.useRef(null),n=i!=="textarea",g={as:n?"div":o.Fragment,className:n?"nhsuk-character-count":void 0,"data-module":n?"nhsuk-character-count":void 0,"data-maxwords":i==="word-count"?t:void 0,"data-maxlength":i==="character-count"?e:void 0},p=d.useMemo(()=>{if(i==="character-count")return`You have ${e} characters remaining`;if(i==="word-count")return`You have ${t} words remaining`},[i,t,e]);return d.useEffect(()=>{var c,h;if(!n||!a.current)return;const u=(h=(c=a.current.parentElement)==null?void 0:c.closest(".nhsuk-character-count"))==null?void 0:h.parentElement;u&&setTimeout(()=>{M({scope:u})},0)}),o.createElement($,{...g},o.createElement(b,{as:"textarea",inputType:"textarea",...s,ref:a,render:({id:u,name:c,className:h,withError:f,...v})=>o.createElement(o.Fragment,null,o.createElement("textarea",{id:u,name:c,className:C("nhsuk-textarea",{"nhsuk-textarea--error":f,"nhsuk-js-character-count":n},h),...v}),n&&o.createElement(k,{className:"nhsuk-character-count__message",id:`${u}-info`},p))}))});m.displayName="Textarea";m.__docgenInfo={description:"",methods:[],displayName:"Textarea"};export{m as T};
